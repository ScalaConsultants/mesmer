<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-supported-libraries/zio/zio-example">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.3.1">
<title data-rh="true">Example | Mesmer</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://mesmer.io/docs/supported-libraries/zio/zio-example"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Example | Mesmer"><meta data-rh="true" name="description" content="ZIO exposes a lot of information about its own and application internals out-of-the-box - like ZIO Executor metrics and JVM metrics. In addition integrated ZIO Metrics DSL allows us to create custom metrics measuring effects of our choice."><meta data-rh="true" property="og:description" content="ZIO exposes a lot of information about its own and application internals out-of-the-box - like ZIO Executor metrics and JVM metrics. In addition integrated ZIO Metrics DSL allows us to create custom metrics measuring effects of our choice."><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://mesmer.io/docs/supported-libraries/zio/zio-example"><link data-rh="true" rel="alternate" href="https://mesmer.io/docs/supported-libraries/zio/zio-example" hreflang="en"><link data-rh="true" rel="alternate" href="https://mesmer.io/docs/supported-libraries/zio/zio-example" hreflang="x-default"><link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=GTM-K3T2K2J"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","GTM-K3T2K2J",{})</script><link rel="stylesheet" href="/assets/css/styles.3f3d4718.css">
<link rel="preload" href="/assets/js/runtime~main.9a7cadc1.js" as="script">
<link rel="preload" href="/assets/js/main.cd852185.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/mesmer-small.png" alt="Mesmer Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/mesmer-small.png" alt="Mesmer Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">Mesmer</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/intro">Documentation</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/ScalaConsultants/mesmer" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/intro">Introduction</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/getting-started">Getting started</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/configuration">Configuration</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--active">Supported libraries</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="true" tabindex="0" href="/docs/supported-libraries/akka/supported-metrics">Akka</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/supported-libraries/akka/supported-metrics">Supported metrics</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/supported-libraries/akka/actor-grouping">Actor grouping</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" tabindex="0" href="/docs/supported-libraries/zio/supported-metrics">ZIO</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/supported-libraries/zio/supported-metrics">Supported metrics</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/supported-libraries/zio/zio-example">Example</a></li></ul></li></ul></li></ul></nav></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Supported libraries</span><meta itemprop="position" content="1"></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">ZIO</span><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Example</span><meta itemprop="position" content="3"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Example</h1><p>ZIO exposes a lot of information about its own and application internals out-of-the-box - like ZIO Executor metrics and JVM metrics. In addition integrated ZIO Metrics DSL allows us to create custom metrics measuring effects of our choice.</p><p>When combined with OpenTelemetry Java Agent we&#x27;re provided with even more extensive data about different parts our application.</p><p>In this example we will:</p><ul><li>create a simple web application</li><li>enable all the available ZIO internal metrics</li><li>add additional custom ZIO Metrics</li><li>run the application with OpenTelemetry Java Agent and Mesmer extension</li></ul><p>The end result will be multiple metrics automatically exported to the metrics backend of our choice.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="basic-application">Basic application<a href="#basic-application" class="hash-link" aria-label="Direct link to Basic application" title="Direct link to Basic application">​</a></h2><p>We start with a simple ZIO HTTP application serving a <code>/healthcheck</code> endpoint that answers with a <code>204 No Content</code> response.</p><p>First we need add our dependencies and create the application:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">libraryDependencies ++= Seq(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;dev.zio&quot; %% &quot;zio&quot;      % zioVersion,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;dev.zio&quot; %% &quot;zio-http&quot; % zioHttpVersion</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-scala codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">import zio._</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import zio.http._</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import zio.http.model.{ Method, Status }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">object AppZioHttp extends ZIOAppDefault {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  val routes = Http.collectZIO[Request] {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    case Method.GET -&gt; !! / &quot;healthcheck&quot; =&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ZIO.succeed(Response.status(Status.NoContent))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  override val run = </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Server.serve(routes).provide(Server.default)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="enable-zio-runtime-and-jvm-metrics">Enable ZIO Runtime and JVM metrics<a href="#enable-zio-runtime-and-jvm-metrics" class="hash-link" aria-label="Direct link to Enable ZIO Runtime and JVM metrics" title="Direct link to Enable ZIO Runtime and JVM metrics">​</a></h2><div class="language-scala codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">import zio._</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import zio.http._</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import zio.http.model.{ Method, Status }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import zio.metrics.jvm.DefaultJvmMetrics</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">object AppZioHttp extends ZIOAppDefault {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  val routes = Http.collectZIO[Request] {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    case Method.GET -&gt; !! / &quot;healthcheck&quot; =&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ZIO.succeed(Response.status(Status.NoContent))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  override val run = </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Server.serve(routes).provide(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      Server.default,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      Runtime.enableRuntimeMetrics,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      DefaultJvmMetrics.live.unit</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="add-zio-metrics">Add ZIO Metrics<a href="#add-zio-metrics" class="hash-link" aria-label="Direct link to Add ZIO Metrics" title="Direct link to Add ZIO Metrics">​</a></h2><p>Now let&#x27;s add a simple metric that will count the requests:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">import zio._</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import zio.http._</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import zio.http.model.{ Method, Status }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import zio.metrics._</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import zio.metrics.jvm.DefaultJvmMetrics</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">object AppZioHttp extends ZIOAppDefault {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  val requestCount = </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Metric.counterInt(&quot;request_count&quot;).fromConst(1)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      .tagged(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        MetricLabel(&quot;method&quot;, &quot;GET&quot;),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        MetricLabel(&quot;handler&quot;, &quot;/healthcheck&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  val routes = Http.collectZIO[Request] {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    case Method.GET -&gt; !! / &quot;healthcheck&quot; =&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ZIO.succeed(Response.status(Status.NoContent)) @@ requestCount</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  override val run = </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Server.serve(routes).provide(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      Server.default,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      Runtime.enableRuntimeMetrics,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      DefaultJvmMetrics.live.unit</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>From the application code perspective this is all we need to export metrics to an OpenTelemetry collector. The rest is about OpenTelemetry and Mesmer configuration.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="running-the-application-with-java-agent">Running the application with Java agent<a href="#running-the-application-with-java-agent" class="hash-link" aria-label="Direct link to Running the application with Java agent" title="Direct link to Running the application with Java agent">​</a></h2><p>Right now our application doesn&#x27;t export any metrics as it doesn&#x27;t know anything about OpenTelemetry and has no ZIO Metrics exporter declared. And we want it to stay that way.</p><p>By running the application with OpenTelemetry Agent and Mesmer extension we achieve 2 things:</p><ul><li>OpenTelemetry Agent will auto-instrument all the supported libraries that it detects (in our case Netty is the significant one because of ZIO HTTP)</li><li>Mesmer extension will auto-instrument all the metrics exposed by ZIO and translate it to OpenTelemetry instruments.</li></ul><p>To run the application with Java agents from <code>sbt</code> add these lines to the <code>build.sbt</code> file:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">run / fork := true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">run / javaOptions ++= Seq(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;-javaagent:path/to/opentelemetry-javaagent.jar&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;-Dotel.javaagent.extensions=path/to/mesmer-otel-extension.jar&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>You can find more information about downloading these files at the <a href="/docs/getting-started">Getting Started</a> page.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="running-the-opentelemetry-collector">Running the OpenTelemetry Collector<a href="#running-the-opentelemetry-collector" class="hash-link" aria-label="Direct link to Running the OpenTelemetry Collector" title="Direct link to Running the OpenTelemetry Collector">​</a></h2><p>By default Mesmer and OpenTelemetry agent will export metrics using OTLP over gRPC to an OTel Collector running at localhost.</p><p>To run OTel Collector using docker-compose add this to your docker-compose.yaml:</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">version</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;3.3&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">services</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">otel-collector</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">container_name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> my_otel_collector</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> otel/opentelemetry</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">collector</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">contrib</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">dev</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">latest</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">command</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">-</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">config=/etc/otel</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">collector</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">config.yaml</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">volumes</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> ./otel</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">collector</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">config.yaml</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">/etc/otel</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">collector</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">config.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">ports</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> 1888</span><span class="token punctuation" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">1888</span><span class="token plain">     </span><span class="token comment" style="color:#999988;font-style:italic"># pprof extension</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> 8888</span><span class="token punctuation" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">8888</span><span class="token plain">     </span><span class="token comment" style="color:#999988;font-style:italic"># Prometheus metrics exposed by the collector</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> 8889</span><span class="token punctuation" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">8889</span><span class="token plain">     </span><span class="token comment" style="color:#999988;font-style:italic"># Prometheus exporter metrics</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> 13133</span><span class="token punctuation" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">13133</span><span class="token plain">   </span><span class="token comment" style="color:#999988;font-style:italic"># health_check extension</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> 55681</span><span class="token punctuation" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">55679</span><span class="token plain">   </span><span class="token comment" style="color:#999988;font-style:italic"># zpages extension</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> 4317</span><span class="token punctuation" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">4317</span><span class="token plain">     </span><span class="token comment" style="color:#999988;font-style:italic"># otlp receiver</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Docker-compose will expect <code>otel-collector-config.yaml</code> file to exist. </p><p>This is an example configuration for a Collector exposing metrics in Prometheus format:</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">receivers</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">otlp</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">protocols</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">grpc</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">exporters</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">prometheus</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">endpoint</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 0.0.0.0</span><span class="token punctuation" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">8889</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">namespace</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> testzioapp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">logging</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">loglevel</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> info</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">processors</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">batch</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">extensions</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">health_check</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">pprof</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">endpoint</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">1888</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">zpages</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">endpoint</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">55679</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">service</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">extensions</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">pprof</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> zpages</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> health_check</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">pipelines</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">metrics</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">receivers</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">otlp</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">processors</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">batch</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">exporters</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">prometheus</span><span class="token punctuation" style="color:#393A34">]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>More about OTel Collector configuration can found <a href="https://opentelemetry.io/docs/collector/configuration/" target="_blank" rel="noopener noreferrer">here</a>.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="run-the-application">Run the application<a href="#run-the-application" class="hash-link" aria-label="Direct link to Run the application" title="Direct link to Run the application">​</a></h2><p>Now with all of the above set up we can run the application from <code>sbt</code></p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">sbt run</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>and make a couple of calls to the <code>/healthcheck</code> endpoint</p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">curl http://localhost:8080/healthcheck</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="check-the-metrics">Check the metrics<a href="#check-the-metrics" class="hash-link" aria-label="Direct link to Check the metrics" title="Direct link to Check the metrics">​</a></h2><p>To get the metrics from OTel Collector we can use the same endpoint as Prometheus would use to acquire them:</p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">curl http://localhost:8889/metrics</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>In the response body we will receive a list of metrics in the Prometheus format with different name prefixes. Following is the list of all of the metrics broken down by name prefix: </p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="mesmer_zio_executor">mesmer_zio_executor<a href="#mesmer_zio_executor" class="hash-link" aria-label="Direct link to mesmer_zio_executor" title="Direct link to mesmer_zio_executor">​</a></h3><p>ZIO Executor metrics exposed by ZIO</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">mesmer_zio_executor_dequeued_count - The number of tasks that have been dequeued, over all time.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mesmer_zio_executor_size           - The number of tasks remaining to be executed.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mesmer_zio_executor_worker_count   - The number of current live worker threads.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mesmer_zio_executor_enqueued_count - The number of tasks that have been enqueued, over all time.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mesmer_zio_executor_concurrency    - The concurrency level of the executor.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mesmer_zio_executor_capacity       - The capacity of the executor.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="mesmer_zio_forwarded">mesmer_zio_forwarded<a href="#mesmer_zio_forwarded" class="hash-link" aria-label="Direct link to mesmer_zio_forwarded" title="Direct link to mesmer_zio_forwarded">​</a></h3><p>This name prefix includes runtime and JVM metrics (enabled by additional <code>ZLayers</code>) as well as the custom merics defined using ZIO Metrics DSL.</p><p>The custom <code>request_count</code> metric (in full Prometheus format):</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">mesmer_zio_forwarded_request_count_total{otel_scope_name=&quot;mesmer&quot;,handler=&quot;/healthcheck&quot;,method=&quot;GET&quot;} 10.0 1680557471485</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>ZIO Runtime and JVM metrics:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">mesmer_zio_forwarded_zio_fiber_successes_total </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mesmer_zio_forwarded_process_max_fds </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mesmer_zio_forwarded_process_resident_memory_bytes </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mesmer_zio_forwarded_process_open_fds </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mesmer_zio_forwarded_process_cpu_seconds_total </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mesmer_zio_forwarded_process_virtual_memory_bytes </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mesmer_zio_forwarded_process_start_time_seconds </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mesmer_zio_forwarded_jvm_buffer_pool_capacity_bytes </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mesmer_zio_forwarded_jvm_threads_started_total </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mesmer_zio_forwarded_jvm_memory_pool_bytes_used </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mesmer_zio_forwarded_jvm_threads_daemon </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mesmer_zio_forwarded_jvm_gc_collection_seconds_count </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mesmer_zio_forwarded_jvm_memory_pool_bytes_committed </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mesmer_zio_forwarded_jvm_threads_peak </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mesmer_zio_forwarded_jvm_memory_pool_collection_committed_bytes </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mesmer_zio_forwarded_jvm_memory_bytes_max </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mesmer_zio_forwarded_jvm_memory_pool_bytes_init </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mesmer_zio_forwarded_jvm_buffer_pool_used_buffers </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mesmer_zio_forwarded_jvm_memory_pool_bytes_max </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mesmer_zio_forwarded_jvm_memory_bytes_used </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mesmer_zio_forwarded_jvm_threads_current </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mesmer_zio_forwarded_jvm_classes_loaded </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mesmer_zio_forwarded_jvm_classes_loaded_total </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mesmer_zio_forwarded_jvm_memory_pool_collection_used_bytes </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mesmer_zio_forwarded_jvm_gc_collection_seconds_sum </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mesmer_zio_forwarded_jvm_memory_pool_allocated_bytes_total_total </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mesmer_zio_forwarded_jvm_classes_unloaded_total </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mesmer_zio_forwarded_jvm_memory_pool_collection_max_bytes </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mesmer_zio_forwarded_jvm_memory_pool_collection_init_bytes </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mesmer_zio_forwarded_jvm_threads_deadlocked_monitor </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mesmer_zio_forwarded_jvm_threads_state </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mesmer_zio_forwarded_jvm_threads_deadlocked </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mesmer_zio_forwarded_jvm_memory_objects_pending_finalization </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mesmer_zio_forwarded_jvm_buffer_pool_used_bytes </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mesmer_zio_forwarded_jvm_memory_bytes_committed </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mesmer_zio_forwarded_jvm_info </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mesmer_zio_forwarded_jvm_memory_bytes_init </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="http_server">http_server<a href="#http_server" class="hash-link" aria-label="Direct link to http_server" title="Direct link to http_server">​</a></h3><p>Metrics provided by OpenTelemetry Agent&#x27;s auto-instrumentation for Netty:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">http_server_duration        - The duration of the inbound HTTP request</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">http_server_request_size    - The size of HTTP request messages</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">http_server_active_requests - The number of concurrent HTTP requests that are currently in-flight</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="process_runtime">process_runtime<a href="#process_runtime" class="hash-link" aria-label="Direct link to process_runtime" title="Direct link to process_runtime">​</a></h3><p>JVM metrics provided by OpenTelemetry Agent</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">process_runtime_jvm_threads_count              - Number of executing threads</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">process_runtime_jvm_classes_current_loaded     - Number of classes currently loaded</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">process_runtime_jvm_memory_committed           - Measure of memory committed</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">process_runtime_jvm_buffer_usage               - Memory that the Java virtual machine is using for this buffer pool</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">process_runtime_jvm_memory_usage               - Measure of memory used</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">process_runtime_jvm_system_cpu_load_1m         - Average CPU load of the whole system for the last minute</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">process_runtime_jvm_classes_unloaded_total     - Number of classes unloaded since JVM start</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">process_runtime_jvm_buffer_count               - The number of buffers in the pool</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">process_runtime_jvm_gc_duration                - Duration of JVM garbage collection actions</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">process_runtime_jvm_memory_init                - Measure of initial memory requested</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">process_runtime_jvm_memory_usage_after_last_gc - Measure of memory used after the most recent garbage collection event on this pool</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">process_runtime_jvm_system_cpu_utilization     - Recent cpu utilization for the whole system</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">process_runtime_jvm_buffer_limit               - Total capacity of the buffers in this pool</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">process_runtime_jvm_classes_loaded_total       - Number of classes loaded since JVM start</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">process_runtime_jvm_memory_limit               - Measure of max obtainable memory</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">process_runtime_jvm_cpu_utilization            - Recent cpu utilization for the process</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="next-steps">Next steps<a href="#next-steps" class="hash-link" aria-label="Direct link to Next steps" title="Direct link to Next steps">​</a></h2><p>TODO Connect Prometheus and Graphana</p></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/supported-libraries/zio/supported-metrics"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Supported metrics</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#basic-application" class="table-of-contents__link toc-highlight">Basic application</a></li><li><a href="#enable-zio-runtime-and-jvm-metrics" class="table-of-contents__link toc-highlight">Enable ZIO Runtime and JVM metrics</a></li><li><a href="#add-zio-metrics" class="table-of-contents__link toc-highlight">Add ZIO Metrics</a></li><li><a href="#running-the-application-with-java-agent" class="table-of-contents__link toc-highlight">Running the application with Java agent</a></li><li><a href="#running-the-opentelemetry-collector" class="table-of-contents__link toc-highlight">Running the OpenTelemetry Collector</a></li><li><a href="#run-the-application" class="table-of-contents__link toc-highlight">Run the application</a></li><li><a href="#check-the-metrics" class="table-of-contents__link toc-highlight">Check the metrics</a><ul><li><a href="#mesmer_zio_executor" class="table-of-contents__link toc-highlight">mesmer_zio_executor</a></li><li><a href="#mesmer_zio_forwarded" class="table-of-contents__link toc-highlight">mesmer_zio_forwarded</a></li><li><a href="#http_server" class="table-of-contents__link toc-highlight">http_server</a></li><li><a href="#process_runtime" class="table-of-contents__link toc-highlight">process_runtime</a></li></ul></li><li><a href="#next-steps" class="table-of-contents__link toc-highlight">Next steps</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/intro">Documentation</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://twitter.com/scalac_io" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.linkedin.com/company/scalac" target="_blank" rel="noopener noreferrer" class="footer__link-item">LinkedIn<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.facebook.com/scalac.io" target="_blank" rel="noopener noreferrer" class="footer__link-item">Facebook<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.instagram.com/scalac.backstage/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Instagram<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/ScalaConsultants/mesmer" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2023 Scalac Sp. z o.o. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.9a7cadc1.js"></script>
<script src="/assets/js/main.cd852185.js"></script>
</body>
</html>
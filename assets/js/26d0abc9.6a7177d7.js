"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[917],{3905:function(e,t,n){n.d(t,{Zo:function(){return m},kt:function(){return d}});var r=n(7294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var p=r.createContext({}),s=function(e){var t=r.useContext(p),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},m=function(e){var t=s(e.components);return r.createElement(p.Provider,{value:t},e.children)},c={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},u=r.forwardRef((function(e,t){var n=e.components,a=e.mdxType,o=e.originalType,p=e.parentName,m=l(e,["components","mdxType","originalType","parentName"]),u=s(n),d=a,k=u["".concat(p,".").concat(d)]||u[d]||c[d]||o;return n?r.createElement(k,i(i({ref:t},m),{},{components:n})):r.createElement(k,i({ref:t},m))}));function d(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var o=n.length,i=new Array(o);i[0]=u;var l={};for(var p in t)hasOwnProperty.call(t,p)&&(l[p]=t[p]);l.originalType=e,l.mdxType="string"==typeof e?e:a,i[1]=l;for(var s=2;s<o;s++)i[s]=n[s];return r.createElement.apply(null,i)}return r.createElement.apply(null,n)}u.displayName="MDXCreateElement"},9164:function(e,t,n){n.r(t),n.d(t,{assets:function(){return m},contentTitle:function(){return p},default:function(){return d},frontMatter:function(){return l},metadata:function(){return s},toc:function(){return c}});var r=n(3117),a=n(102),o=(n(7294),n(3905)),i=["components"],l={sidebar_position:2},p="Getting started",s={unversionedId:"getting-started",id:"getting-started",title:"Getting started",description:"Here you will find instructions on how to add OpenTelemetry Agent with Mesmer extension to your application and make it export metrics to your chosen backend service.",source:"@site/../mesmer-docs/target/mdoc/getting-started.md",sourceDirName:".",slug:"/getting-started",permalink:"/docs/getting-started",draft:!1,tags:[],version:"current",sidebarPosition:2,frontMatter:{sidebar_position:2},sidebar:"tutorialSidebar",previous:{title:"Introduction",permalink:"/docs/intro"},next:{title:"Supported metrics",permalink:"/docs/supported-metrics"}},m={},c=[{value:"Basic setup",id:"basic-setup",level:2},{value:"Akka-specific setup",id:"akka-specific-setup",level:2},{value:"ZIO-specific setup",id:"zio-specific-setup",level:2}],u={toc:c};function d(e){var t=e.components,n=(0,a.Z)(e,i);return(0,o.kt)("wrapper",(0,r.Z)({},u,n,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"getting-started"},"Getting started"),(0,o.kt)("p",null,"Here you will find instructions on how to add OpenTelemetry Agent with Mesmer extension to your application and make it export metrics to your chosen backend service."),(0,o.kt)("p",null,"OpenTelemetry supports exporting telemetry data with multiple different protocols. You will find the list of exporters and their configuration options ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/open-telemetry/opentelemetry-java/blob/main/sdk-extensions/autoconfigure/README.md#exporters"},"here"),"."),(0,o.kt)("p",null,"This guide presents steps for Prometheus and OTEL (native OpenTelemetry protocol) exporters."),(0,o.kt)("h2",{id:"basic-setup"},"Basic setup"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Download ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/open-telemetry/opentelemetry-java-instrumentation/releases/download/v1.13.1/opentelemetry-javaagent.jar"},"opentelemetry-javaagent.jar")," from ",(0,o.kt)("inlineCode",{parentName:"p"},"opentelemetry-java")," Releases.")),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Download ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/ScalaConsultants/mesmer/releases/download/v0.8.0.RC1/mesmer-otel-extension.jar"},"mesmer-otel-extension.jar")," from ",(0,o.kt)("inlineCode",{parentName:"p"},"mesmer")," Releases.")),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Add the dependency on OpenTelemetry autoconfiguration extension to your ",(0,o.kt)("inlineCode",{parentName:"p"},"build.sbt")," file:"),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-scala"},'libraryDependencies ++= Seq(\n  "io.opentelemetry" % "opentelemetry-sdk-extension-autoconfigure" % "1.13.0-alpha"\n)\n'))),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Add an exporter for your favorite protocol to your ",(0,o.kt)("inlineCode",{parentName:"p"},"build.sbt")," file:"),(0,o.kt)("p",{parentName:"li"},(0,o.kt)("strong",{parentName:"p"},"For OTLP")),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-scala"},'libraryDependencies ++= Seq(\n  "io.opentelemetry" % "opentelemetry-exporter-otlp" % "1.13.0",\n)\n')),(0,o.kt)("p",{parentName:"li"},(0,o.kt)("strong",{parentName:"p"},"For Prometheus")),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-scala"},'libraryDependencies ++= Seq(\n  "io.opentelemetry" % "opentelemetry-exporter-prometheus" % "1.13.0-alpha".\n)\n'))),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Run the application with the following options:"),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-sh"},"-javaagent:path/to/opentelemetry-javaagent.jar\n-Dotel.javaagent.extensions=mesmer-otel-extension.jar\n# add the following option if you're using Prometheus exporter\n-Dotel.metrics.exporter=prometheus\n")),(0,o.kt)("p",{parentName:"li"},"Eg. if you're running the application with ",(0,o.kt)("inlineCode",{parentName:"p"},"sbt run")," add this to ",(0,o.kt)("inlineCode",{parentName:"p"},"build.sbt")," file:"),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-scala"},'run / fork := true\nrun / javaOptions ++= Seq(\n  "-javaagent:path/to/opentelemetry-javaagent.jar",\n  "-Dotel.javaagent.extensions=path/to/mesmer-otel-extension.jar",\n  // add the following option if you\'re using Prometheus exporter\n  "-Dotel.metrics.exporter=prometheus"\n)\n')),(0,o.kt)("p",{parentName:"li"},"or if you're running your application as a ",(0,o.kt)("inlineCode",{parentName:"p"},"jar")," from command line:"),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-sh"},"java \\\n  -javaagent:path/to/opentelemetry-javaagent.jar \\\n  -Dotel.javaagent.extensions=path/to/mesmer-otel-extension.jar \\\n  # add the following option if you're using Prometheus exporter\n  -Dotel.metrics.exporter=prometheus \\\n  -jar your-app.jar\n"))),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Test it:"),(0,o.kt)("p",{parentName:"li"},(0,o.kt)("strong",{parentName:"p"},"For OTLP")),(0,o.kt)("p",{parentName:"li"},"You need to have a running OTLP Collector for the metrics to be automatically streamed to it."),(0,o.kt)("p",{parentName:"li"},(0,o.kt)("strong",{parentName:"p"},"For Prometheus")),(0,o.kt)("p",{parentName:"li"},"Call the metrics endpoint:"),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-sh"},"curl -i http://localhost:9464\n")))),(0,o.kt)("h2",{id:"akka-specific-setup"},"Akka-specific setup"),(0,o.kt)("p",null,"Add Mesmer Akka extension:"),(0,o.kt)("p",null,"   Add the following dependency to your ",(0,o.kt)("inlineCode",{parentName:"p"},"build.sbt")," file:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-scala"},'libraryDependencies += "io.scalac" %% "mesmer-akka-extension" % "0.8.0.RC1"\n')),(0,o.kt)("p",null,"   Add this entry to your ",(0,o.kt)("inlineCode",{parentName:"p"},"application.conf"),":"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},'akka.actor.typed.extensions = ["io.scalac.mesmer.extension.AkkaMonitoring"]\n')),(0,o.kt)("h2",{id:"zio-specific-setup"},"ZIO-specific setup"),(0,o.kt)("p",null,"Enable all available ZIO metrics by adding the following layers to your program:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"Runtime.enableRuntimeMetrics")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"DefaultJvmMetrics.live.unit"))),(0,o.kt)("p",null,"Eg."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-scala"},"myProgram.provide(\n  Runtime.enableRuntimeMetrics,\n  DefaultJvmMetrics.live.unit,\n)\n")),(0,o.kt)("p",null,"For full reference see this ZIO 2.0 SampleApp code:"),(0,o.kt)("p",null,(0,o.kt)("a",{parentName:"p",href:"https://github.com/zio/zio-metrics-connectors/blob/zio/series2.x/core/jvm/src/test/scala/zio/metrics/connectors/SampleApp.scala#L15-L71"},"https://github.com/zio/zio-metrics-connectors/blob/zio/series2.x/core/jvm/src/test/scala/zio/metrics/connectors/SampleApp.scala#L15-L71")),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Important for v0.8.0.RC1")),(0,o.kt)("p",null,"At this moment (v0.8.0.RC1) Mesmer is closely bound with Akka. This is something we're working on, but until then there's a specific step that needs to be made in non-Akka applications. The application needs to be run with these additional parameters (that will turn off Akka instrumentation):"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sh"},"-Dotel.instrumentation.mesmer-akka-actor.enabled=false\n-Dotel.instrumentation.mesmer-akka-http.enabled=false\n-Dotel.instrumentation.mesmer-akka-persistence.enabled=false\n-Dotel.instrumentation.mesmer-akka-stream.enabled=false\n")))}d.isMDXComponent=!0}}]);